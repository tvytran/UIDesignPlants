{% extends "base.html" %}

{% block title %}{{ plant.name }} - PlantPal{% endblock %}

{% block content %}
    <div class="plant-detail-container">
        {# Top Section: Plant Name #}
        <h1 class="text-3xl sm:text-4xl font-extrabold text-duo-text mb-8 text-center">{{ plant.name }}</h1>

        {# Tab Navigation #}
        <div class="mb-6 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="plantTab" role="tablist">
                <li class="mr-2" role="presentation">
                    <button class="inline-block p-4 border-b-2 rounded-t-lg font-bold uppercase tracking-wider" id="overview-tab" data-tabs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
                </li>
                <li class="mr-2" role="presentation">
                    <button class="inline-block p-4 border-b-2 rounded-t-lg font-bold uppercase tracking-wider border-transparent hover:text-gray-600 hover:border-gray-300" id="lighting-tab" data-tabs-target="#lighting" type="button" role="tab" aria-controls="lighting" aria-selected="false">üí° Lighting</button>
                </li>
                <li class="mr-2" role="presentation">
                    <button class="inline-block p-4 border-b-2 rounded-t-lg font-bold uppercase tracking-wider border-transparent hover:text-gray-600 hover:border-gray-300" id="facts-tab" data-tabs-target="#facts" type="button" role="tab" aria-controls="facts" aria-selected="false">‚ú® Facts</button>
                </li>
            </ul>
        </div>

        {# Tab Content #}
        <div id="plantTabContent">
            {# Overview Tab Panel #}
            <div class="tab-pane active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-start p-4">
                    <div class="plant-image-section text-center">
                        <img src="{{ url_for('static', filename='images/' + plant.image) }}" alt="{{ plant.name }}" 
                             class="w-full max-w-sm mx-auto rounded-2xl shadow-lg border border-gray-200 object-cover h-80 md:h-96">
                    </div>
                    <div class="plant-overview-text space-y-6">
                         <div>
                            <h2 class="text-xl font-bold text-duo-text mb-2 flex items-center"><span class="mr-2 text-lg">üìñ</span> Description</h2>
                            <p class="text-gray-600 leading-relaxed">
                                {{ plant.description if plant.description else "A lovely houseplant. More details coming soon!" }}
                             </p>
                         </div>
                         <div>
                            <h2 class="text-xl font-bold text-duo-text mb-2 flex items-center"><span class="mr-2 text-lg">üíß</span> Watering</h2>
                            <p class="text-gray-600 leading-relaxed">
                                {{ plant.watering if plant.watering else "Watering information not available." }}
                             </p>
                         </div>
                          <div>
                            <h2 class="text-xl font-bold text-duo-text mb-2 flex items-center"><span class="mr-2 text-lg">‚òÄÔ∏è</span> Sunlight</h2>
                            <p class="text-gray-600 leading-relaxed">
                                {{ plant.sunlight if plant.sunlight else "Sunlight requirements information not available." }}
                            </p>
                         </div>
                    </div>
                </div>
            </div>

            {# Lighting Tab Panel (Initially Hidden) #}
            <div class="hidden tab-pane p-4 rounded-lg bg-gray-50" id="lighting" role="tabpanel" aria-labelledby="lighting-tab">
                <h2 class="text-2xl font-bold text-duo-text mb-2 text-center">Ideal Lighting Spot</h2>
                <p class="text-gray-500 mb-6 max-w-lg mx-auto text-center">
                    Based on its needs (<strong>{{ correct_zone.replace('-', ' ').title() if correct_zone else 'Unknown Zone' }}</strong>), 
                    this is the ideal spot for your {{ plant.name }} in this room layout:
                </p>
                {# Define zone positions #}
                {# bright-indirect: Top-Left #}
                {# low-medium: Top-Right #}
                {# moderate-indirect: Bottom-Left #}
                {# bright-filtered: Bottom-Right #}
                {% set zone_styles = {
                    'bright-indirect': 'top: 25%; left: 25%;',
                    'low-medium': 'top: 25%; left: 75%;',
                    'moderate-indirect': 'top: 75%; left: 25%;',
                    'bright-filtered': 'top: 75%; left: 75%;'
                } %}
                {% set position_style = zone_styles.get(correct_zone, 'top: 50%; left: 50%;') %}
                
                {# Container for the background image - Apply consistent styles #}
                <div class="relative w-full max-w-xl mx-auto rounded-xl shadow-lg border border-gray-200 overflow-hidden" 
                     style="padding-top: 66.66%; background-image: url('{{ url_for('static', filename='images/istockphoto-149468256-612x612.jpg') }}'); background-size: cover; background-position: center;"> 
                    {# Position the plant image #}
                    {% if correct_zone %}
                    <img src="{{ url_for('static', filename='images/' + plant.image) }}" 
                         alt="{{ plant.name }} placed in its ideal lighting spot ({{ correct_zone.replace('-', ' ').title() }})"
                         title="Ideal Spot: {{ correct_zone.replace('-', ' ').title() }}"
                         class="absolute w-16 h-16 sm:w-20 sm:h-20 object-contain drop-shadow-lg transform -translate-x-1/2 -translate-y-1/2 border-2 border-white rounded-full shadow-xl"
                         style="{{ position_style }}">
                    {% else %}
                     <p class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-red-600 font-semibold bg-white/80 p-2 rounded">Could not determine correct lighting zone.</p>
                    {% endif %}
                </div>
            </div>

            {# Facts Tab Panel (Initially Hidden) - Changed to Card Format #}
            <div class="hidden tab-pane p-4 rounded-lg bg-gray-50" id="facts" role="tabpanel" aria-labelledby="facts-tab">
                 <div class="max-w-3xl mx-auto">
                    <h2 class="text-2xl font-bold text-duo-text mb-6 text-center">Fun Facts! ‚ú®</h2>
                     <div class="space-y-4">
                        {% if plant.facts %}
                            {% for fact in plant.facts %}
                            <div class="fact-card bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex items-start space-x-3">
                                <span class="text-duo-green text-xl mt-1">üå±</span>
                                <p class="text-duo-text leading-relaxed">{{ fact }}</p>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-center text-gray-500 italic">No fun facts available for this plant yet.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {# Consistent Back Link #}
         <div class="mt-12 text-center">
            <a href="{{ url_for('plants') }}" 
               class="inline-block text-gray-500 hover:text-duo-green font-semibold text-sm underline underline-offset-2">
                &larr; Back to All Plants
            </a>
        </div>

    </div>
{% endblock %}

{% block scripts %}
<script>
    // Basic Tab Functionality with Transitions
    document.addEventListener('DOMContentLoaded', () => {
        const tabElements = document.querySelectorAll('[data-tabs-target]');
        const tabContent = document.getElementById('plantTabContent');

        // Function to handle tab switching
        function switchTab(targetTabButton) {
             const targetSelector = targetTabButton.getAttribute('data-tabs-target');
             const targetPanel = document.querySelector(targetSelector);

             // Hide all panels with transition
             tabContent.querySelectorAll('.tab-pane').forEach(panel => {
                 if (panel !== targetPanel) {
                     panel.classList.add('opacity-0', 'invisible');
                     setTimeout(() => { panel.classList.add('hidden'); }, 150); // Hide after transition (duration-150)
                 }
             });

             // Deactivate all tabs
             document.querySelectorAll('#plantTab [role="tab"]').forEach(t => {
                 t.setAttribute('aria-selected', 'false');
                 t.classList.remove('text-duo-blue', 'border-duo-blue');
                 t.classList.add('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
             });

             // Show target panel with transition
             if (targetPanel) {
                 targetPanel.classList.remove('hidden');
                 // Use a tiny timeout to allow 'hidden' removal to render before starting transition
                 setTimeout(() => {
                     targetPanel.classList.remove('opacity-0', 'invisible');
                 }, 10); 
             }

             // Activate clicked tab
             targetTabButton.setAttribute('aria-selected', 'true');
             targetTabButton.classList.add('text-duo-blue', 'border-duo-blue');
             targetTabButton.classList.remove('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
        }

        // Set initial active tab styles and prepare panes
        tabContent.querySelectorAll('.tab-pane').forEach(panel => {
            panel.classList.add('transition-opacity', 'duration-150', 'ease-in-out'); // Add base transition classes
            if (!panel.getAttribute('aria-labelledby').includes(document.querySelector('#plantTab [aria-selected="true"]').id)) {
                panel.classList.add('opacity-0', 'invisible', 'hidden');
            } else {
                panel.classList.remove('opacity-0', 'invisible', 'hidden'); // Ensure initial active pane is visible
            }
        });
        const initialActiveTab = document.querySelector('#plantTab [aria-selected="true"]');
        if (initialActiveTab) {
             initialActiveTab.classList.add('text-duo-blue', 'border-duo-blue');
             initialActiveTab.classList.remove('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
        }

        // Add click listeners
        tabElements.forEach(tab => {
            tab.addEventListener('click', event => {
                switchTab(event.target);
            });
        });
    });
</script>
{% endblock %}